---
# tasks file for docker
# here we gonna make docker installation task

#first we udate cashe
- name: cashe_update
  apt:
    update-cache: yes
  when: ansible_facts['distribution'] == 'Ubuntu'

#second we prepare env for docker
- name: prepare_docker_env
  apt:
    name: "{{item}}"
    state: present
  loop:
    - ca-certificates
    - curl
  when: ansible_facts['distribution'] == 'Ubuntu'


#Add Docker's official GPG key and the repository to Apt sources
- name: excute_shell_commands
  shell:
    cmd: |
      install -m 0755 -d /etc/apt/keyrings
      curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
      chmod a+r /etc/apt/keyrings/docker.asc
      echo \
      "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
      $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
      sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
  register: check_docker
  when: ansible_facts['distribution'] == 'Ubuntu'

#cashe update again
- name: cashe_update
  apt:
    update-cache: yes
  when: ansible_facts['distribution'] == 'Ubuntu' and check_docker.changed == true

#finnaly we install docker 
- name: install docker
  apt:
    name: "{{item}}"
    state: present
  loop:
    - docker-ce
    - docker-ce-cli
    - containerd.io
    - docker-buildx-plugin
    - docker-compose-plugin
  when: ansible_facts['distribution'] == 'Ubuntu'

#--------------------------------------------------------------------------------------------------------------------------------------------------

#install docker on cnetos
- name: install_yum_utls
  yum:
    name: yum_utils
    state: present
  when: ansible_facts['distribution'] == 'Centos'

- name: excute shell commands
  shell:
    cmd:
      yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
  when: ansible_facts['distribution'] == 'Centos'
  register: check_docker_centos

- name: install_docker_backages
  apt:
    name: "{{item}}"
    state: present
  loop:
    - ocker-ce
    - docker-ce-cli
    - containerd.io
    - docker-buildx-plugin
    - docker-compose-plugin
  when: ansible_facts['distribution'] == 'Centos' and check_docker_centos.changed == ture



































